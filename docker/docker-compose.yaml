services:
  # This service is used to build the Docker image
  # The docker image is built from the root directory
  orbit:
    build:
      context: ../
      dockerfile: docker/Dockerfile
      args:
        - DOCKER_USER_HOME=${DOCKER_USER_HOME}
    image: ai_olympics
    container_name: ai_olympics
    env_file:
      - .env
      # We set DOCKER_ISAACSIM_PATH and then forward it to ISAACSIM_PATH within
      # the container to avoid collision with pre-existing ISAACSIM_PATH env vars
      # that could come from installing Orbit on the local machine, causing build errors
    environment:
      # This should also be enabled for X11 forwarding
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=/tmp/.docker.xauth
      - TERM=xterm-256color
    volumes:
        # These volumes allow X11 Forwarding
      - type: bind
        source: /tmp/.X11-unix
        target: /tmp/.X11-unix
      - type: bind
        source: /tmp/.docker.xauth
        target: /tmp/.docker.xauth
        # This overlay allows changes on the local files to
        # be reflected within the container immediately
      - type: bind
        source: ../
        target: /double_pendulum
      # - type: bind
      #   source: ../src
      #   target: /double_pendulum/src
    network_mode: host
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    # This is the entrypoint for the container
    entrypoint: bash
    stdin_open: true
    tty: true

# volumes:
#   # isaac-sim
#   isaac-cache-kit:
#   isaac-cache-ov:
#   isaac-cache-pip:
#   isaac-cache-gl:
#   isaac-cache-compute:
#   isaac-logs:
#   isaac-carb-logs:
#   isaac-data:
#   isaac-docs:
#   # orbit
#   orbit-docs:
#   orbit-logs:
#   orbit-data:
